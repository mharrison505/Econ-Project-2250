---
title: "Econ Final Presentation"
format: revealjs
editor: visual
---

```{r}
#Im testing to see if it works

knitr::opts_chunk$set(warning = FALSE, message = FALSE)
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
tidyverse,
probstats4econ,
kableExtra,
RColorBrewer,
curl,
usethis,
ggrepel)

#X2022WITHWINS%>%glimpse()

```

```{r}
#all the 2022 stats, wins v PA
library(ggplot2)
library(ggrepel)

# Helper function to compute r and r2 label
make_r_label <- function(x, y) {
  r <- cor(x, y)
  r2 <- r^2
  paste0("r = ", round(r, 3),
         "\nr² = ", round(r2, 3))
}

### 1. Wins vs Points Allowed (PA)
ggplot(X2022WITHWINS, aes(x = Wins, y = PA, label = Tm)) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  geom_smooth(method = "lm", color = "green", se = FALSE) +
  labs(x = "Wins", y = "Points Allowed", title = "NFL 2022 Wins vs Points Allowed") +
  annotate("text",
           x = max(X2022WITHWINS$Wins),
           y = min(X2022WITHWINS$PA),
           label = make_r_label(X2022WITHWINS$Wins, X2022WITHWINS$PA),
           hjust = 1, vjust = 0) +
  theme_minimal()


### 2. Wins vs Rushing Yards/Game (RY/G)
ggplot(X2022WITHWINS, aes(x = Wins, y = `RY/G`, label = Tm)) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  geom_smooth(method = "lm", color = "green", se = FALSE) +
  labs(x = "Wins", y = "Rushing Yards Per Game", title = "NFL 2022 Wins vs Rushing Yards Per Game") +
  annotate("text",
           x = max(X2022WITHWINS$Wins),
           y = min(X2022WITHWINS$`RY/G`),
           label = make_r_label(X2022WITHWINS$Wins, X2022WITHWINS$`RY/G`),
           hjust = 1, vjust = 0) +
  theme_minimal()


### 3. Wins vs Passing Yards/Game (PY/G)
ggplot(X2022WITHWINS, aes(x = Wins, y = `PY/G`, label = Tm)) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  geom_smooth(method = "lm", color = "green", se = FALSE) +
  labs(x = "Wins", y = "Passing Yards Per Game", title = "NFL 2022 Wins vs Passing Yards Per Game") +
  annotate("text",
           x = max(X2022WITHWINS$Wins),
           y = min(X2022WITHWINS$`PY/G`),
           label = make_r_label(X2022WITHWINS$Wins, X2022WITHWINS$`PY/G`),
           hjust = 1, vjust = 0) +
  theme_minimal()


### 4. Wins vs Points Scored (Pts For)
ggplot(X2022WITHWINS, aes(x = Wins, y = `Pts For`, label = Tm)) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  geom_smooth(method = "lm", color = "green", se = FALSE) +
  labs(x = "Wins", y = "Points Scored Per Game", title = "NFL 2022 Wins vs Points Scored Per Game") +
  annotate("text",
           x = max(X2022WITHWINS$Wins),
           y = min(X2022WITHWINS$`Pts For`),
           label = make_r_label(X2022WITHWINS$Wins, X2022WITHWINS$`Pts For`),
           hjust = 1, vjust = 0) +
  theme_minimal()


### 5. Wins vs Passing Yards Allowed (PYdsA)
ggplot(X2022WITHWINS, aes(x = Wins, y = PYdsA, label = Tm)) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  geom_smooth(method = "lm", color = "green", se = FALSE) +
  labs(x = "Wins", y = "Passing Yards Allowed Per Game", title = "NFL 2022 Wins vs Passing Yards Allowed") +
  annotate("text",
           x = max(X2022WITHWINS$Wins),
           y = min(X2022WITHWINS$PYdsA),
           label = make_r_label(X2022WITHWINS$Wins, X2022WITHWINS$PYdsA),
           hjust = 1, vjust = 0) +
  theme_minimal()


### 6. Wins vs Rushing Yards Allowed (RYdsA)
ggplot(X2022WITHWINS, aes(x = Wins, y = RYdsA, label = Tm)) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  geom_smooth(method = "lm", color = "green", se = FALSE) +
  labs(x = "Wins", y = "Rushing Yards Allowed Per Game", title = "NFL 2022 Wins vs Rushing Yards Allowed") +
  annotate("text",
           x = max(X2022WITHWINS$Wins),
           y = min(X2022WITHWINS$RYdsA),
           label = make_r_label(X2022WITHWINS$Wins, X2022WITHWINS$RYdsA),
           hjust = 1, vjust = 0) +
  theme_minimal()

```

```{r}
# Passing Yards A Game

plot(NEWNEWNEW2021NFL$Win1,
     NEWNEWNEW2021NFL$PY_G,
     xlab = "Wins",
     ylab = "Passing Yards/Game",
     main = "NFL Wins vs Passing Yards/Game (2021)")


text(NEWNEWNEW2021NFL$Win1,
     NEWNEWNEW2021NFL$PY_G,
     labels = NEWNEWNEW2021NFL$Tm,
     pos = 3,
     cex = 0.5)


model <- lm(PY_G ~ Win1, data = NEWNEWNEW2021NFL)


abline(model, col = "green", lwd = 2)


eq <- paste0("y = ",
             round(coef(model)[2], 2),
             "x + ",
             round(coef(model)[1], 2))

text(x = max(NEWNEWNEW2021NFL$Win1),
     y = min(NEWNEWNEW2021NFL$PY_G),
     labels = eq,
     pos = 4)

library(ggplot2)
library(ggrepel)

ggplot(NEWNEWNEW2021NFL, aes(x = Win1, y = PY_G, label = Tm)) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  labs(x = "Wins",
       y = "Passing Yards/Game",
       title = "NFL Wins vs Passing Yards (2021)") +
  theme_minimal()

ggplot(NEWNEWNEW2021NFL, aes(x = Win1, y = PY_G, label = Tm)) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "green") +
  annotate("text",
           x = max(NEWNEWNEW2021NFL$Win1),
           y = max(NEWNEWNEW2021NFL$PY_G),
           label = paste0("R = ", round(sign(coef(model)[2]) * sqrt(summary(model)$r.squared), 3),
                          ", R² = ", round(summary(model)$r.squared, 3)),
           hjust = 1) +
  labs(x = "Wins",
       y = "Passing Yards/Game",
       title = "NFL Wins vs Passing Yards/Game (2021)") +
  theme_minimal()

# Rushing Yards A GAME

plot(NEWNEWNEW2021NFL$Win2,
     NEWNEWNEW2021NFL$RY_G,
     xlab = "Wins",
     ylab = "Rushing Yards/Game",
     main = "NFL Wins vs Rushing Yards/Game (2021)")


text(NEWNEWNEW2021NFL$Win2,
     NEWNEWNEW2021NFL$RY_G,
     labels = NEWNEWNEW2021NFL$Tm.1,
     pos = 3,
     cex = 0.5)


model2 <- lm(RY_G ~ Win2, data = NEWNEWNEW2021NFL)


abline(model2, col = "blue", lwd = 2)


eq2 <- paste0("y = ",
             round(coef(model2)[2], 2),
             "x + ",
             round(coef(model2)[1], 2))

text(x = max(NEWNEWNEW2021NFL$Win2),
     y = min(NEWNEWNEW2021NFL$RY_G),
     labels = eq2,
     pos = 4)

library(ggplot2)
library(ggrepel)

ggplot(NEWNEWNEW2021NFL, aes(x = Win2, y = RY_G, label = Tm.1)) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  labs(x = "Wins",
       y = "Rushing Yards/Game",
       title = "NFL Wins vs Rushing Yards (2021)") +
  theme_minimal()
ggplot(NEWNEWNEW2021NFL, aes(x = Win2, y = RY_G, label = Tm.1)) +
geom_point(size = 3) +
geom_text_repel(size = 3) +
geom_smooth(method = "lm", se = FALSE, color = "blue") +
annotate("text",
x = max(NEWNEWNEW2021NFL$Win2),
y = max(NEWNEWNEW2021NFL$RY_G),
label = paste0("R = ", round(sign(coef(model2)[2]) * sqrt(summary(model2)$r.squared), 3),
", R² = ", round(summary(model2)$r.squared, 3)),
hjust = 1) +
labs(x = "Wins",
y = "Rushing Yards/Game",
title = "NFL Wins vs Rushing Yards/Game (2021)") +
theme_minimal()

# Points per Game.


library(ggplot2)
library(ggrepel)

plot(NEWNEWNEW2021NFL$Win3,
NEWNEWNEW2021NFL$Pts_G,
xlab = "Wins",
ylab = "Points/Game",
main = "NFL Wins vs Points/Game (2021)")

text(NEWNEWNEW2021NFL$Win3,
NEWNEWNEW2021NFL$Pts_G,
labels = NEWNEWNEW2021NFL$Tm.2,
pos = 3,
cex = 0.5)

model3 <- lm(Pts_G ~ Win3, data = NEWNEWNEW2021NFL)


abline(model3, col = "blue", lwd = 2)


eq3 <- paste0("y = ",
round(coef(model3)[2], 2),
"x + ",
round(coef(model3)[1], 2))

text(x = max(NEWNEWNEW2021NFL$Win3),
y = min(NEWNEWNEW2021NFL$Pts_G),
labels = eq3,
pos = 4)


ggplot(NEWNEWNEW2021NFL, aes(x = Win3, y = Pts_G, label = Tm.2)) +
geom_point(size = 3) +
geom_text_repel(size = 3) +
labs(x = "Wins",
y = "Points/Game",
title = "NFL Wins vs Points/Game (2021)") +
theme_minimal()

ggplot(NEWNEWNEW2021NFL, aes(x = Win3, y = Pts_G, label = Tm.2)) +
geom_point(size = 3) +
geom_text_repel(size = 3) +
geom_smooth(method = "lm", se = FALSE, color = "blue") +
annotate("text",
x = max(NEWNEWNEW2021NFL$Win3),
y = max(NEWNEWNEW2021NFL$Pts_G),
label = paste0("R = ", round(sign(coef(model3)[2]) * sqrt(summary(model3)$r.squared), 3),
", R² = ", round(summary(model3)$r.squared, 3)),
hjust = 1) +
labs(x = "Wins",
y = "Points/Game",
title = "NFL Wins vs Points/Game (2021)") +
theme_minimal()


# PASSING YARDS ALLOWED


library(ggplot2)
library(ggrepel)


plot(NEWNEWNEW2021NFL$Win4,
NEWNEWNEW2021NFL$PYA_G,
xlab = "Wins",
ylab = "Passing Yards Allowed/Game",
main = "NFL Wins vs Passing Yards Allowed/Game (2021)")


text(NEWNEWNEW2021NFL$Win4,
NEWNEWNEW2021NFL$PYA_G,
labels = NEWNEWNEW2021NFL$Tm.3,
pos = 3,
cex = 0.5)


model4 <- lm(PYA_G ~ Win4, data = NEWNEWNEW2021NFL)


abline(model4, col = "blue", lwd = 2)


eq4 <- paste0("y = ",
round(coef(model4)[2], 2),
"x + ",
round(coef(model4)[1], 2))

text(x = max(NEWNEWNEW2021NFL$Win4),
y = min(NEWNEWNEW2021NFL$PYA_G),
labels = eq4,
pos = 4)


ggplot(NEWNEWNEW2021NFL, aes(x = Win4, y = PYA_G, label = Tm.3)) +
geom_point(size = 3) +
geom_text_repel(size = 3) +
labs(x = "Wins",
y = "Passing Yards Allowed/Game",
title = "NFL Wins vs Passing Yards Allowed/Game (2021)") +
theme_minimal()
ggplot(NEWNEWNEW2021NFL, aes(x = Win4, y = PYA_G, label = Tm.3)) +
geom_point(size = 3) +
geom_text_repel(size = 3) +
geom_smooth(method = "lm", se = FALSE, color = "blue") +
annotate("text",
x = max(NEWNEWNEW2021NFL$Win4),
y = max(NEWNEWNEW2021NFL$PYA_G),
label = paste0("R = ", round(sign(coef(model4)[2]) * sqrt(summary(model4)$r.squared), 3),
", R² = ", round(summary(model4)$r.squared, 3)),
hjust = 1) +
labs(x = "Wins",
y = "Passing Yards Allowed/Game",
title = "NFL Wins vs Passing Yards Allowed/Game (2021)") +
theme_minimal()


# Rushing Yards Allowed


library(ggplot2)
library(ggrepel)


plot(NEWNEWNEW2021NFL$Win5,
NEWNEWNEW2021NFL$RYA_G,
xlab = "Wins",
ylab = "Rushing Yards Allowed/Game",
main = "NFL Wins vs Rushing Yards Allowed/Game (2021)")


text(NEWNEWNEW2021NFL$Win5,
NEWNEWNEW2021NFL$RYA_G,
labels = NEWNEWNEW2021NFL$Tm.4,
pos = 3,
cex = 0.5)


model5 <- lm(RYA_G ~ Win5, data = NEWNEWNEW2021NFL)


abline(model5, col = "blue", lwd = 2)


eq5 <- paste0("y = ",
round(coef(model5)[2], 2),
"x + ",
round(coef(model5)[1], 2))

text(x = max(NEWNEWNEW2021NFL$Win5),
y = min(NEWNEWNEW2021NFL$RYA_G),
labels = eq5,
pos = 4)


ggplot(NEWNEWNEW2021NFL, aes(x = Win5, y = RYA_G, label = Tm.4)) +
geom_point(size = 3) +
geom_text_repel(size = 3) +
labs(x = "Wins",
y = "Rushing Yards Allowed/Game",
title = "NFL Wins vs Rushing Yards Allowed/Game (2021)") +
theme_minimal()

ggplot(NEWNEWNEW2021NFL, aes(x = Win5, y = RYA_G, label = Tm.4)) +
geom_point(size = 3) +
geom_text_repel(size = 3) +
geom_smooth(method = "lm", se = FALSE, color = "blue") +
annotate("text",
x = max(NEWNEWNEW2021NFL$Win5),
y = max(NEWNEWNEW2021NFL$RYA_G),
label = paste0("R = ", round(sign(coef(model5)[2]) * sqrt(summary(model5)$r.squared), 3),
", R² = ", round(summary(model5)$r.squared, 3)),
hjust = 1) +
labs(x = "Wins",
y = "Rushing Yards Allowed/Game",
title = "NFL Wins vs Rushing Yards Allowed/Game (2021)") +
theme_minimal()

# Points Allowed


library(ggplot2)
library(ggrepel)


plot(NEWNEWNEW2021NFL$Win6,
NEWNEWNEW2021NFL$PA_G,
xlab = "Wins",
ylab = "Points Allowed/Game",
main = "NFL Wins vs Points Allowed/Game (2021)")


text(NEWNEWNEW2021NFL$Win6,
NEWNEWNEW2021NFL$PA_G,
labels = NEWNEWNEW2021NFL$Tm.5,
pos = 3,
cex = 0.5)

model6 <- lm(PA_G ~ Win6, data = NEWNEWNEW2021NFL)

abline(model6, col = "blue", lwd = 2)



eq6 <- paste0("y = ",
round(coef(model6)[2], 2),
"x + ",
round(coef(model6)[1], 2))

text(x = max(NEWNEWNEW2021NFL$Win6),
y = min(NEWNEWNEW2021NFL$PA_G),
labels = eq6,
pos = 4)



ggplot(NEWNEWNEW2021NFL, aes(x = Win6, y = PA_G, label = Tm.5)) +
geom_point(size = 3) +
geom_text_repel(size = 3) +
labs(x = "Wins",
y = "Points Allowed/Game",
title = "NFL Wins vs Points Allowed/Game (2021)") +
theme_minimal()

ggplot(NEWNEWNEW2021NFL, aes(x = Win6, y = PA_G, label = Tm.5)) +
geom_point(size = 3) +
geom_text_repel(size = 3) +
geom_smooth(method = "lm", se = FALSE, color = "blue") +
annotate("text",
x = max(NEWNEWNEW2021NFL$Win6),
y = max(NEWNEWNEW2021NFL$PA_G),
label = paste0("R = ", round(sign(coef(model6)[2]) * sqrt(summary(model6)$r.squared), 3),
", R² = ", round(summary(model6)$r.squared, 3)),
hjust = 1) +
labs(x = "Wins",
y = "Points Allowed/Game",
title = "NFL Wins vs Points Allowed/Game (2021)") +
theme_minimal()
```

# 2024 Results

```{r}
{install.packages(c("readxl","ggplot2","dplyr"))}
library(readxl)
library(ggplot2)
library(dplyr)


df <- read_excel("ALLSTATS2024.xlsx")


wins <- df$W


# 1. Pts

stat <- df$Pts
r_value <- cor(wins, stat, use = "complete.obs")
r_sq <- r_value^2

ggplot(df, aes(x = W, y = Pts)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Wins vs Total Points (Pts)",
    subtitle = paste("r =", round(r_value, 4), "  r² =", round(r_sq, 4)),
    x = "Wins",
    y = "Points"
  ) +
  theme_minimal()


# 2. PYds

stat <- df$PYds
r_value <- cor(wins, stat, use = "complete.obs")
r_sq <- r_value^2

ggplot(df, aes(x = W, y = PYds)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Wins vs Passing Yards (PYds)",
    subtitle = paste("r =", round(r_value, 4), "  r² =", round(r_sq, 4)),
    x = "Wins",
    y = "Passing Yards"
  ) +
  theme_minimal()


# 3. RYds

stat <- df$RYds
r_value <- cor(wins, stat, use = "complete.obs")
r_sq <- r_value^2

ggplot(df, aes(x = W, y = RYds)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Wins vs Rushing Yards (RYds)",
    subtitle = paste("r =", round(r_value, 4), "  r² =", round(r_sq, 4)),
    x = "Wins",
    y = "Rushing Yards"
  ) +
  theme_minimal()


# 4. PtsA

stat <- df$PtsA
r_value <- cor(wins, stat, use = "complete.obs")
r_sq <- r_value^2

ggplot(df, aes(x = W, y = PtsA)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Wins vs Points Allowed (PtsA)",
    subtitle = paste("r =", round(r_value, 4), "  r² =", round(r_sq, 4)),
    x = "Wins",
    y = "Points Allowed"
  ) +
  theme_minimal()


# 5. PYdsA

stat <- df$PYdsA
r_value <- cor(wins, stat, use = "complete.obs")
r_sq <- r_value^2

ggplot(df, aes(x = W, y = PYdsA)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Wins vs Passing Yards Allowed (PYdsA)",
    subtitle = paste("r =", round(r_value, 4), "  r² =", round(r_sq, 4)),
    x = "Wins",
    y = "Passing Yards Allowed"
  ) +
  theme_minimal()


# 6. RYdsA

stat <- df$RYdsA
r_value <- cor(wins, stat, use = "complete.obs")
r_sq <- r_value^2

ggplot(df, aes(x = W, y = RYdsA)) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Wins vs Rushing Yards Allowed (RYdsA)",
    subtitle = paste("r =", round(r_value, 4), "  r² =", round(r_sq, 4)),
    x = "Wins",
    y = "Rushing Yards Allowed"
  ) +
  theme_minimal()

model <- lm(W ~ Pts + PYds + RYds + PtsA + PYdsA + RYdsA, data = nfl_data)
summary(model)$coefficients


```

```{r}

# ---- Helper function (tidy-eval version) ----
plot_stat <- function(df, xvar, yvar, ylab, title, color="blue") {
  
  # tidy evaluation symbols
  x <- rlang::ensym(xvar)
  y <- rlang::ensym(yvar)
  
  # clean data
  temp <- df %>% select(Team, !!x, !!y) %>% na.omit()
  
  # fit model
  model <- lm(temp %>% pull(!!y) ~ temp %>% pull(!!x))
  R_val  <- sign(coef(model)[2]) * sqrt(summary(model)$r.squared)
  R2_val <- summary(model)$r.squared
  
  # plot
  ggplot(temp, aes(x = !!x, y = !!y, label = Team)) +
    geom_point(size = 3) +
    geom_text_repel(size = 3) +
    geom_smooth(method = "lm", se = FALSE, color = color) +
    annotate(
      "text",
      x = Inf, y = Inf,
      hjust = 1.1, vjust = 1.1,
      size = 4,
      label = paste0(
        "R = ", round(R_val, 3),
        "\nR2 = ", round(R2_val, 3)
      )
    ) +
    labs(
      x = "Wins",
      y = ylab,
      title = title
    ) +
    theme_minimal()
}


# ---- ALL SIX GRAPHS ----

# 1. Wins vs Passing Yards/Game
plot_stat(
  nfl_2019, "W", "PassYds_pg",
  "Passing Yards per Game",
  "NFL 2019: Wins vs Passing Yards/Game",
  color = "green"
)

# 2. Wins vs Rushing Yards/Game
plot_stat(
  nfl_2019, "W", "RushYds_pg",
  "Rushing Yards per Game",
  "NFL 2019: Wins vs Rushing Yards/Game",
  color = "blue"
)

# 3. Wins vs Points/Game
plot_stat(
  nfl_2019, "W", "Pts_pg",
  "Points per Game",
  "NFL 2019: Wins vs Points per Game",
  color = "purple"
)

# 4. Wins vs Passing Yards Allowed/Game
plot_stat(
  nfl_2019, "W", "PassYdsAllowed_pg",
  "Passing Yards Allowed per Game",
  "NFL 2019: Wins vs Passing Yards Allowed/Game",
  color = "red"
)

# 5. Wins vs Rushing Yards Allowed/Game
plot_stat(
  nfl_2019, "W", "RushYdsAllowed_pg",
  "Rushing Yards Allowed per Game",
  "NFL 2019: Wins vs Rushing Yards Allowed/Game",
  color = "orange"
)

# 6. Wins vs Points Allowed/Game
plot_stat(
  nfl_2019, "W", "PtsAllowed_pg",
  "Points Allowed per Game",
  "NFL 2019: Wins vs Points Allowed/Game",
  color = "brown"
)
```
