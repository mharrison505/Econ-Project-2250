```{r}
#Stats
install.packages("ggplot2")   # only if not installed
library(ggplot2)
install.packages("ggrepel")   # only if not installed
library(ggrepel)
```

```{r}


# Helper function to compute r and r2 label
make_r_label <- function(x, y) {
  r <- cor(x, y)
  r2 <- r^2
  paste0("r = ", round(r, 3),
         "\nrÂ² = ", round(r2, 3))
}

### 1. PA vs PYdsA
ggplot(NFL_Stats, aes(x = PA, y = PYdsA, label = '')) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  geom_smooth(method = "lm", color = "green", se = FALSE) +
  labs(x = "Points Allowed", y = "Passing Yards Allowed", title = "NFL Points Allowed vs Passing Yards Allowed") +
  annotate("text",
           x = max(NFL_Stats$PA),
           y = min(NFL_Stats$PYdsA),
           label = make_r_label(NFL_Stats$PA, NFL_Stats$PYdsA),
           hjust = 1, vjust = 0) +
  theme_minimal()

## 2. PA vs RYdsA
ggplot(NFL_Stats, aes(x = PA, y = RYdsA, label = '')) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  geom_smooth(method = "lm", color = "green", se = FALSE) +
  labs(x = "Points Allowed", y = "Rushing Yards Allowed", title = "NFL Points Allowed vs Rushing Yards Allowed") +
  annotate("text",
           x = max(NFL_Stats$PA),
           y = min(NFL_Stats$RYdsA),
           label = make_r_label(NFL_Stats$PA, NFL_Stats$RYdsA),
           hjust = 1, vjust = 0) +
  theme_minimal()

##PA vs Takeaways
ggplot(NFL_Stats, aes(x = PA, y = `Takeaways(Defense)`, label = '')) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  geom_smooth(method = "lm", color = "green", se = FALSE) +
  labs(x = "Points Allowed", y = "Takeaways", title = "NFL Points Allowed vs Takeaways") +
  annotate("text",
           x = max(NFL_Stats$PA),
           y = min(NFL_Stats$`Takeaways(Defense)`),
           label = make_r_label(NFL_Stats$PA, NFL_Stats$`Takeaways(Defense)`),
           hjust = 1, vjust = 0) +
  theme_minimal()

##Points For vs RY/G
ggplot(NFL_Stats, aes(x = `Pts For`, y = `RY/G`, label = '')) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  geom_smooth(method = "lm", color = "green", se = FALSE) +
  labs(x = "Points Scored", y = "Rushing Yards", title = "NFL Points Scored vs Rushing Yards") +
  annotate("text",
           x = max(NFL_Stats$`Pts For`),
           y = min(NFL_Stats$`RY/G`),
           label = make_r_label(NFL_Stats$`Pts For`, NFL_Stats$`RY/G`),
           hjust = 1, vjust = 0) +
  theme_minimal()

## Pts For vs PY/G
ggplot(NFL_Stats, aes(x = `Pts For`, y = `PY/G`, label = '')) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  geom_smooth(method = "lm", color = "green", se = FALSE) +
  labs(x = "Points Scored", y = "Passing Yards", title = "NFL Points Scored vs Passing Yards") +
  annotate("text",
           x = max(NFL_Stats$`Pts For`),
           y = min(NFL_Stats$`PY/G`),
           label = make_r_label(NFL_Stats$`Pts For`, NFL_Stats$`PY/G`),
           hjust = 1, vjust = 0) +
  theme_minimal()

## Pts For vs TO Lost
ggplot(NFL_Stats, aes(x = `Pts For`, y = `TO Lost (Offense)`, label = '')) +
  geom_point(size = 3) +
  geom_text_repel(size = 3) +
  geom_smooth(method = "lm", color = "green", se = FALSE) +
  labs(x = "Points Scored", y = "Turnovers Lost", title = "NFL Points Scored vs Turnovers Lost") +
  annotate("text",
           x = max(NFL_Stats$`Pts For`),
           y = min(NFL_Stats$`TO Lost (Offense)`),
           label = make_r_label(NFL_Stats$`Pts For`, NFL_Stats$`TO Lost (Offense)`),
           hjust = 1, vjust = 0) +
  theme_minimal()
# View coefficient tests
summary(model)$coefficients
```
```{r}
# Optional: nicer p-value formatting
options(scipen = 5)

offense_model <- lm(`Pts For` ~ `PY/G` + `RY/G` + `TO Lost (Offense)`,
                    data =NFL_Stats)

defense_model <- lm(PA ~ PYdsA + RYdsA + `Takeaways(Defense)`,
                    data = NFL_Stats)

offense_coefs <- summary(offense_model)$coefficients
offense_coefs

defense_coefs <- summary(defense_model)$coefficients
defense_coefs

```

